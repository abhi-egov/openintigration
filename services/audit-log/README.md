![prod](https://img.shields.io/badge/Status-Production-brightgreen.svg)

<p align="center">
  <img src="https://github.com/openintegrationhub/openintegrationhub/blob/master/Assets/medium-oih-einzeilig-zentriert.jpg" alt="Sublime's custom image" width="400"/>
</p>

The revolution in data synchronization â€” the Open Integration Hub enables simple data synchronization between any software applications and thus accelerates digitalisation

Visit the official [Open Integration Hub homepage](https://www.openintegrationhub.org/)

# Audit Log

The OIH Audit Log serves to receive, store, and return logging information about important user actions and system events. Other OIH Microservices can generate audit messages and pass them on to the Audit Log via the message and event bus or a simple HTTP POST request.

Stored Logs can be retrieved by authorized users through a simple REST API. The Audit Log offers several functions to filter and search through the accumulated logs.

## Technical description

The Audit Log receives messages either via POST or by publishing them to the appropriate RabbitMQ exchange and topics, using the OIH Event Bus. Received logs will be stored in MongoDB instance. Retrieving logs can be done via a single GET endpoint with a variety of filters and options. See the provided Swagger-documentation for further information.

Logs will be stored in the following schema:

```json
{
  "headers": {
    "serviceName": "String",
    "createdAt": "Date",
    "nameSpace": "String"
  },
  "payload": "Object"
}
```

`headers` are automatically generated by the OIH event bus. `payload` contains the actual content of the logged event, as specified by the sending service. This can be arbitrary JSON, however two optional keys are reserved:

- `user`: contains the id of the user responsible for spawning the event, if applicable
- `tenant`: contains the id of the tenant responsible for spawning the event, if applicable

## Local installation/development

### Without Docker:

- Ensure that both a local MongoDB Database and RabbitMQ instance are running
- Run `npm install` to install dependencies.
- If using the IAM middleware/features, set the environment variable `INTROSPECT_ENDPOINT_BASIC` to match the respective endpoint used by your used IAM instance.
- Run `npm start`
- To simplify publishing events to your local queue to be read by the Audit Log, you can use the provided file `/test/utils/generate-events.js`

### With Docker:

- Ensure a local MongoDB Database is running
- Build (with `docker build . -t [IMAGENAME]`) or download the docker image
- Run the image with `docker run --network="host" [IMAGENAME]`
- If using the IAM middleware/features, set the environment variables to match those used by your IAM instance by using the `-e` option for `docker run`. For example: `docker run -e "INTROSPECT_ENDPOINT_BASIC=http://localhost:3099/api/v1/tokens/introspect" -t --network="host" [IMAGENAME]`

The folder `examples` contains an example script that will publish a log event to a local RabbitMQ server, where a local instance of the Audit Log should be able to receive it.

## REST-API documentation

Visit auditlog.openintegrationhub.com/api-docs/ to view the Swagger API-Documentation

## Current status

This is a prototypical implementation to demonstrate basic functionality.
